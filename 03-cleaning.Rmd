```{r,echo = FALSE}
library(ggplot2)
library(dplyr)
library(tidyverse)

```

# Data transformation



## COVID-19 Dataset

This file contains information on the number and estimated percentage of NYC residents fully vaccinated and residents who received at least one dose of COVID-19 vaccine by Modified ZCTA (MODZCTA). Percentages of NYC residents vaccinated is calculated against the estimated total population of the specified MODZCTA.

Note that the number of people vaccinated may exceed the estimated population and lead to more than 100% vaccination coverage, especially for smaller demographic categories and geographies. 

Since the dataset provided is already clean, we only need to extracted the necessary columns that are mentioned in the previous chapter. 

```{R,echo = FALSE}
coverage = data.frame(read_csv('data/coverage-by-boro-demo.csv')) %>% select('BOROUGH','AGE_GROUP','RACE_ETHNICITY','PERC_FULLY','PERC_1PLUS')
```

## Crime Dataset

## Air Quality Dataset

We first extracted the necessary columns that are mentioned in the previous chapter. Then we notice that in the `Measure` column, there are only two values, we only use Mean as out measure since there are not enough data for the other one.

```{r,echo = FALSE}
air_qua = data.frame(read_csv('data/Air_Quality_2016_2018.csv') %>% select('Name', 'Measure', 'Geo Join ID', 'Start_Date', 'Data Value'))
air_quality = air_qua
knitr::kable(as.data.frame(table(air_quality$Measure)), caption = "Measure Counts",row.names = F,font_size = 10)
air_quality = air_quality %>% filter(Measure =='Mean')
```
In the `Measure` column, there are only three values. After counting the numbers of different values, we decide not to remove any values.


```{r, echo = FALSE}
knitr::kable(as.data.frame(table(air_quality$Name)), caption = "Measure Counts",row.names = F,font_size = 10)
```

After removing some observations, we notice that in this data, there are hundreds of values in  `Neighborhood name` columns, we need to use the `Geo Join ID` column to classify them into different boroughs. The `Geo Join ID` variable is the identifier of the neighborhood geographic area, which is a three or six digits number. The first digit represents different boroughs.


```{r,echo = FALSE}
air_quality$Borough = 'Bronx'
air_quality$Geo.Join.ID = as.character(air_quality$Geo.Join.ID)
for(i in 1:nrow(air_quality)){
  tmp = substr(air_quality[i,3],1,1)
  if(tmp == '2'){
    air_quality[i,6] = 'Brooklyn'
  }
  if(tmp == '3'){
    air_quality[i,6] = 'Manhattan'
  }
  if(tmp == '4'){
    air_quality[i,6] = 'Queens'
  }
  if(tmp == '5'){
    air_quality[i,6] = 'Staten Island'
  }
}
ggplot(air_quality, aes(x = fct_relevel(Borough,'Manhattan','Brooklyn','Queens','Bronx'))) +
  geom_histogram(stat="count")+
  xlab('Borough')+
  ylab('Count')+
  ggtitle('Number of observations in different boroughs')
  
```

From the histogram above we can see that after classification, the dataset seems to be pretty balanced.
