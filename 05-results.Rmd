```{r,echo = FALSE}
library(ggplot2)
library(dplyr)
library(tidyverse)

```

# Results


## COVID-19 Dataset

We will draw two headmaps to visualize what are the vaccination rate in different ages, ethnicities in different boroughs and citywide.

```{R,fig.height = 6, fig.width = 10,echo = FALSE}
df_cov = data.frame(read_csv('data/coverage-by-boro-demo.csv')) %>% select('BOROUGH','AGE_GROUP','RACE_ETHNICITY','PERC_FULLY','PERC_1PLUS')
df_cov_d = df_cov %>% pivot_wider(id_cols = c(AGE_GROUP,RACE_ETHNICITY),names_from = BOROUGH, values_from = PERC_FULLY)

df_cov$PERC_FULLY[df_cov$PERC_FULLY>= 99] =99
df_cov$PERC_FULLY = round(df_cov$PERC_FULLY)
df_cov$PERC_1PLUS[df_cov$PERC_1PLUS>= 99] =99
df_cov$PERC_1PLUS = round(df_cov$PERC_1PLUS)
df_cov$BOROUGH = fct_relevel(as.factor(df_cov$BOROUGH),'Citywide','Manhattan','Bronx','Brooklyn','Queens','Staten Island')
df_cov$AGE_GROUP = fct_relevel(as.factor(df_cov$AGE_GROUP),"'65+","'45-64","'18-44","'13-17","'5-12", "All ages")
                      

ggplot(data  = df_cov, aes(x = BOROUGH, y = AGE_GROUP, fill = PERC_FULLY, label = PERC_FULLY)) +
  geom_tile(color = 'black') + facet_wrap(~RACE_ETHNICITY) + 
  scale_fill_gradient(name ="Vaccination Percentage",low = "#DEEBF7", high = "#08519C") +
  geom_text(size = 4)+
  xlab('Boroughs')+
  ylab('Age Groups')+
  ggtitle('Percentage of People Fully Vaccinated')
  
```

From the above plot we can observe percentage of people fully vaccinated in different ages, ethnicities in different boroughs and citywide. 

For different age groups, teenagers and adults have the highest vaccination rate since most of them are required to do so. While kids have lower rates than any other group because some vaccines are not suitable for kids.

For ethnicity, Asian people seem to be more willingly to be vaccinated. While others are basically the same.

For boroughs, Manhattan has the highest vaccination rate for most age groups and ethnicities. The reason behind this might be that Manhattan have more regulations for vaccinations and have higher population density. While in low population density area like Staten Island, people may not be so eager to get vaccinated.

```{R,fig.height = 6, fig.width = 10,echo = FALSE}
ggplot(data  = df_cov, aes(x = BOROUGH, y = AGE_GROUP, fill = PERC_1PLUS, label = PERC_1PLUS)) +
  geom_tile(color = 'black') + facet_wrap(~RACE_ETHNICITY) + 
  scale_fill_gradient(name ="Vaccination Percentage",low = "#DEEBF7", high = "#08519C") +
  geom_text(size = 4)+
  xlab('Boroughs')+
  ylab('Age Groups')+
  ggtitle('Percentage of People Vaccinated')
```
From the above plot we can observe percentage of people vaccinated in different ages, ethnicities in different boroughs and citywide. 

The results do not change a lot from the last one. Teenagers and adults still have the highest vaccination rate and Manhattan has the highest vaccination rate for most age groups and ethnicities.

One interesting fact is that the rate is much higher than rate for fully vaccinated people. An explanation may be that NYC only offer 100$ bonus for the first dose and many people do not think it is necessary to get a second dose.


## Crime Dataset

## Air Quality Dataset

There are three different measures of air quality: Fine Particulate Matter (PM2.5), Nitrogen Dioxide (NO2) and Ozone (O3). In this part, we draw three boxplots and three lineplots to visualize how these three kinds of data distribute in different boroughs and how they change over the time.

```{r,echo = FALSE}
air_quality = data.frame(read_csv('data/Air_Quality_2016_2018.csv') %>% select('Name', 'Measure', 'Geo Join ID', 'Start_Date', 'Data Value'))
air_quality = air_quality %>% filter(Measure =='Mean')
air_quality$Borough = 'Bronx'
air_quality$Geo.Join.ID = as.character(air_quality$Geo.Join.ID)
for(i in 1:nrow(air_quality)){
  tmp = substr(air_quality[i,3],1,1)
  if(tmp == '2'){
    air_quality[i,6] = 'Brooklyn'
  }
  if(tmp == '3'){
    air_quality[i,6] = 'Manhattan'
  }
  if(tmp == '4'){
    air_quality[i,6] = 'Queens'
  }
  if(tmp == '5'){
    air_quality[i,6] = 'Staten Island'
  }
}

```

First, we choose `PM2.5` to draw the plot, which is the most common indicator for air quality.


```{r,echo = FALSE}
d1 = air_quality %>% filter(Name == 'Fine Particulate Matter (PM2.5)') %>% select(Data.Value, Borough)
ggplot(d1,aes(x = Data.Value, y = fct_relevel(Borough,'Staten Island','Queens', 'Brooklyn','Manhattan'))) + 
  geom_boxplot() +
  xlab('Value of indicator')+
  ylab('Borough')+
  ggtitle('PM 2.5 Values for Different Boroughs')

d1_t = air_quality %>% filter(Name == 'Fine Particulate Matter (PM2.5)') %>% select(Start_Date, Data.Value, Borough)
for(i in 1:nrow(d1_t)){
  d1_t[i,1] = paste('20',strsplit(d1_t[i,1], split = '/')[[1]][3],'-', strsplit(d1_t[i,1], split = '/')[[1]][1],sep = '')
}
d1_data = d1_t %>% group_by(Start_Date,Borough) %>% summarize(n = mean(Data.Value))

ggplot(data=d1_data,aes(x=Start_Date, y=n, group=Borough, color=Borough))+
  geom_line()+
  xlab('Year and Month')+
  ylab('Mean Indicator Value')+
  ggtitle('PM 2.5 Values in Different Years')
```

From the plot we can observe that Manhattan and Bronx have the highest mean PM 2.5 value , while Staten Island has a better air quality. Manhattan's PM 2.5 value also varies the most. Besides, Bronx has the most outliers which indicates that there are some places are heavily polluted. The reason behind this might be that Manhattan and Bronx have higher population and less land, which could result in more toxic waste in air.

From the lineplot we can also observe that PM 2.5 in air quality is periodical, which is usually lower in the begining of a year. We can also conclude that for all boroughs, the air quality is getting better and better from 2016 to 2018 as the values are descending.


```{r,echo = FALSE}
d2 = air_quality %>% filter(Name == 'Nitrogen Dioxide (NO2)') %>% select(Data.Value, Borough)
ggplot(d2,aes(x = Data.Value, y = fct_relevel(Borough,'Staten Island','Queens', 'Brooklyn','Manhattan'))) + 
  geom_boxplot() +
  xlab('Value of indicator')+
  ylab('Borough')+
  ggtitle('Nitrogen Dioxide (NO2) Values for Different Boroughs')

d2_t = air_quality %>% filter(Name == 'Nitrogen Dioxide (NO2)') %>% select(Start_Date, Data.Value, Borough)
for(i in 1:nrow(d2_t)){
  d2_t[i,1] = paste('20',strsplit(d2_t[i,1], split = '/')[[1]][3],'-', strsplit(d2_t[i,1], split = '/')[[1]][1],sep = '')
}
d2_data = d2_t %>% group_by(Start_Date,Borough) %>% summarize(n = mean(Data.Value))

ggplot(data=d2_data,aes(x=Start_Date, y=n, group=Borough, color=Borough))+
  geom_line()+
  xlab('Year and Month')+
  ylab('Mean Indicator Value')+
  ggtitle('Nitrogen Dioxide (NO2) Values in Different Years')
```


In the second graph, we use a different measure NO2, and the results are basically the same with the last one depite that Bronx is the leading polluted borough in this measure.

From the lineplot we can also observe that NO2 in air quality is also periodical. One difference from the above one is that the NO2 is usually lower in the middle of a year and peaks in the end of the year. We can also conclude that for all boroughs, the air quality is getting better and better from 2016 to 2018 as the values are descending.


```{r,echo = FALSE}
d3 = air_quality %>% filter(Name == 'Ozone (O3)') %>% select(Data.Value, Borough)
ggplot(d3,aes(x = Data.Value, y = fct_relevel(Borough, 'Bronx','Manhattan','Staten Island','Brooklyn'))) + 
  geom_boxplot() +
  xlab('Value of indicator')+
  ylab('Borough')+
  ggtitle('Ozone (O3) Values for Different Boroughs')

d3_t = air_quality %>% filter(Name == 'Ozone (O3)') %>% select(Start_Date, Data.Value, Borough)
for(i in 1:nrow(d3_t)){
  d3_t[i,1] = paste('20',strsplit(d3_t[i,1], split = '/')[[1]][3],'-', strsplit(d3_t[i,1], split = '/')[[1]][1],sep = '')
}
d3_data = d3_t %>% group_by(Start_Date,Borough) %>% summarize(n = mean(Data.Value))

ggplot(data=d3_data,aes(x=Start_Date, y=n, group=Borough, color=Borough))+
  geom_line()+
  xlab('Year and Month')+
  ylab('Mean Indicator Value')+
  ggtitle('O3 Values in Different Years')
```

Ozone (O3) has become the most dangerous toxic air particles in recent years, which could do serious damage to human lungs. In the third graph, we visualize how O3 data distributed in different boroughs. The results are very different from the last two. Queens becomes the most polluted borough with most outliers. While Mahanttan and Bronx who have most NO2 and PM 2.5 have least O3 in air. We could not find a reason for this observation. However, what we can be sure is that we should use different measures to indicate how air is polluted since different particles may not have the same distributions in boroughs.

The lineplot does not show much information since there are not enough data. We can not be sure if O3 in air quality is also periodical. However, we can observe that for all boroughs, the air quality is first getting better and then getting worse from 2016 to 2018 when considering O3 values. And we should be more careful about O3.
